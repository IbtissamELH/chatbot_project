<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chat Messenger</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .chat-bubble { max-width: 70%; padding: 10px 15px; border-radius: 15px; margin-bottom: 10px; }
        .user { background-color: #d1e7dd; align-self: flex-end; }
        .bot  { background-color: #f8d7da; align-self: flex-start; }
        
    </style>
</head>
<body>
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6">
      <h2 class="mb-4 text-center">ðŸ’¬ Chatbot IA (type Messenger)</h2>

      <div id="chatbox" class="d-flex flex-column mb-3" 
           style="height:400px; overflow-y:auto; border:1px solid #ccc; padding:15px; background:#f9f9f9; border-radius:10px;">
      </div>

      <form id="chat-form" class="input-group">
        <input type="text" id="user-input" class="form-control" placeholder="Pose ta question...">
        <button class="btn btn-primary" type="submit">Envoyer</button>
      </form>
    </div>
  </div>
</div>


<script>
const form = document.getElementById('chat-form');
const input = document.getElementById('user-input');
const chatbox = document.getElementById('chatbox');

form.addEventListener('submit', function(e) {
    e.preventDefault();
    const question = input.value.trim();
    if (!question) return;

    // Affiche la question
    const userBubble = document.createElement('div');
    userBubble.className = 'chat-bubble user align-self-end';
    userBubble.innerText = question;
    chatbox.appendChild(userBubble);
    input.value = "";

    // Appelle lâ€™API
    fetch('/chatbot/api/', {
        method: 'POST',
        headers: {'X-CSRFToken': '{{ csrf_token }}', 'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'question=' + encodeURIComponent(question)
    })
    .then(res => res.json())
    .then(data => {
        const botBubble = document.createElement('div');
        botBubble.className = 'chat-bubble bot';
        botBubble.innerHTML = `<strong>RÃ©ponse:</strong> ${data.reponse}<br><strong>Solution:</strong> ${data.solution}`;
        chatbox.appendChild(botBubble);
scrollToBottom();

        chatbox.scrollTop = chatbox.scrollHeight;
    })
    .catch(() => alert("Erreur lors de la rÃ©ponse."));
});
function scrollToBottom() {
    chatbox.scrollTop = chatbox.scrollHeight;
}

</script>
</body>
</html>
